<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Account - Login & Sign Up</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --primary: #0f172a;
      /* Slate 900 */
      --primary-light: #334155;
      /* Slate 700 */
      --accent: #2563eb;
      /* Blue 600 */
      --accent-hover: #1d4ed8;
      /* Blue 700 */
      --bg-page: #f8fafc;
      /* Slate 50 */
      --bg-card: #ffffff;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --success: #10b981;
      --danger: #ef4444;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--bg-page);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    /* Professional Background Decoration */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50vh;
      background: var(--primary);
      z-index: -1;
      clip-path: polygon(0 0, 100% 0, 100% 70%, 0 100%);
    }

    .container {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
    }

    .auth-card {
      background: var(--bg-card);
      border-radius: 12px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      padding: 40px;
      border: 1px solid var(--border);
    }

    .icon {
      width: 20px;
      height: 20px;
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .brand-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo-box {
      width: 60px;
      height: 60px;
      background: rgba(37, 99, 235, 0.1);
      border-radius: 12px;
      display: flex;
      /* Centering */
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px auto;
      color: var(--accent);
    }

    .brand-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .brand-tagline {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .form-header h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .form-header p {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 25px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .input-wrapper {
      position: relative;
    }

    input {
      width: 100%;
      padding: 12px 16px 12px 40px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-family: inherit;
      font-size: 0.95rem;
      transition: all 0.2s;
      outline: none;
    }

    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .input-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 1.1rem;
    }

    button.btn-primary {
      width: 100%;
      padding: 12px;
      background-color: var(--primary);
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button.btn-primary:hover {
      background-color: var(--primary-light);
    }

    .toggle-link {
      text-align: center;
      margin-top: 25px;
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .toggle-link a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
    }

    .toggle-link a:hover {
      text-decoration: underline;
    }

    .error-message {
      background: #fee2e2;
      color: #b91c1c;
      padding: 10px;
      border-radius: 6px;
      font-size: 0.875rem;
      margin-bottom: 20px;
      text-align: center;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>

  <div class="container">
    <div class="auth-card">
      <!-- Brand Header -->
      <div class="brand-header">
        <div class="logo-box">
          <svg class="icon icon-lg" viewBox="0 0 24 24" style="width: 32px; height: 32px;">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
          </svg>
        </div>
        <h1 class="brand-name">Shield Support</h1>
        <p class="brand-tagline">Secure Enterprise Portal</p>
      </div>

      <!-- LOGIN -->
      <div id="loginBox" class="form-box">
        <div class="form-header" style="text-align: center;">
          <h2>Welcome Back</h2>
          <p>Please enter your credentials to continue</p>
        </div>

        <div id="loginError" class="error-message"></div>

        <div class="form-group">
          <label class="form-label">Email Address</label>
          <div class="input-wrapper">
            <span class="input-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                <polyline points="22,6 12,13 2,6" />
              </svg>
            </span>
            <input type="email" id="loginEmail" placeholder="name@company.com" required>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Password</label>
          <div class="input-wrapper">
            <span class="input-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
              </svg>
            </span>
            <input type="password" id="loginPassword" placeholder="••••••••" required>
            <span class="toggle-password" onclick="togglePassword('loginPassword')"
              style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-muted);">
              <svg class="icon" viewBox="0 0 24 24" id="toggle-loginPassword">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
            </span>
          </div>
        </div>

        <button id="loginBtn" class="btn-primary" onclick="login()">Sign In</button>

        <div class="toggle-link">
          New employee? <a onclick="showSignup()">Create Account</a>
        </div>
      </div>

      <!-- SIGNUP -->
      <div id="signupBox" class="form-box hidden">
        <div class="form-header" style="text-align: center;">
          <h2>Create Account</h2>
          <p>Register for access to the portal</p>
        </div>

        <div id="signupError" class="error-message"></div>

        <div class="form-group">
          <label class="form-label">Full Name</label>
          <div class="input-wrapper">
            <span class="input-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
              </svg>
            </span>
            <input type="text" id="signupName" placeholder="John Doe" required>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Email Address</label>
          <div class="input-wrapper">
            <span class="input-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                <polyline points="22,6 12,13 2,6" />
              </svg>
            </span>
            <input type="email" id="signupEmail" placeholder="name@company.com" required>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Password</label>
          <div class="input-wrapper">
            <span class="input-icon">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
              </svg>
            </span>
            <input type="password" id="signupPassword" placeholder="Minimum 6 characters" required>
            <span class="toggle-password" onclick="togglePassword('signupPassword')"
              style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-muted);">
              <svg class="icon" viewBox="0 0 24 24" id="toggle-signupPassword">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
            </span>
          </div>
        </div>

        <button id="signupBtn" class="btn-primary" onclick="signup()">Create Account</button>

        <div class="toggle-link">
          Already have an account? <a onclick="showLogin()">Sign In</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "http://localhost:5000/api/auth";

    // Toggle password visibility
    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      // Find toggle icon SVG inside the wrapper
      const toggleWrapper = input.parentElement.querySelector('.toggle-password svg');

      if (input.type === 'password') {
        input.type = 'text';
        // Eye Off Icon
        toggleWrapper.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>';
      } else {
        input.type = 'password';
        // Eye Icon
        toggleWrapper.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
      }
    }

    // ... (keep validation logic) ...

    function showSuccess(message) {
      const msg = document.createElement('div');
      msg.className = 'success-message';
      msg.textContent = message; // removed emoji prefix from call
      document.body.appendChild(msg);
      setTimeout(() => msg.remove(), 3000);
    }

    // ... (keep other functions) ...

    // SIGNUP
    async function signup() {
      // ... existing vars ...
      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const btn = document.getElementById('signupBtn');
      // ... 

      // Validation
      if (!name) { showError('signupError', 'Please enter your name'); return; }
      if (!email || !isValidEmail(email)) { showError('signupError', 'Please enter a valid email address'); return; }
      if (!password || password.length < 6) { showError('signupError', 'Password must be at least 6 characters'); return; }

      // ... 

      if (response.ok) {
        showSuccess('Account created successfully! Please sign in.');
        showLogin();
      } else {
        showError('signupError', data.message || 'Signup failed');
      }

      // ...
    }

    // LOGIN
    async function login() {
      // ... existing vars ...
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const btn = document.getElementById('loginBtn');

      // Validation
      if (!email || !isValidEmail(email)) { showError('loginError', 'Please enter a valid email address'); return; }
      if (!password) { showError('loginError', 'Please enter your password'); return; }

      // ... 

      if (!data.token) {
        showError('loginError', data.message || 'Invalid credentials');
        // ...
        return;
      }

      // ...

      showSuccess(`Welcome back, ${data.name}!`);

      // ...
    }

    // Validate email
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    // Real-time validation for inputs
    function setupInputValidation() {
      // Email validation
      const emailInputs = [document.getElementById('loginEmail'), document.getElementById('signupEmail')];
      emailInputs.forEach(input => {
        if (input) {
          input.addEventListener('blur', function () {
            if (this.value.trim()) {
              if (isValidEmail(this.value.trim())) {
                this.classList.remove('error');
                this.classList.add('success');
              } else {
                this.classList.remove('success');
                this.classList.add('error');
              }
            } else {
              this.classList.remove('error', 'success');
            }
          });

          input.addEventListener('input', function () {
            if (this.classList.contains('error') || this.classList.contains('success')) {
              if (this.value.trim() && isValidEmail(this.value.trim())) {
                this.classList.remove('error');
                this.classList.add('success');
              } else if (this.value.trim()) {
                this.classList.remove('success');
                this.classList.add('error');
              }
            }
          });
        }
      });

      // Password validation
      const passwordInputs = [document.getElementById('loginPassword'), document.getElementById('signupPassword')];
      passwordInputs.forEach(input => {
        if (input) {
          input.addEventListener('blur', function () {
            if (this.value) {
              if (this.value.length >= 6) {
                this.classList.remove('error');
                this.classList.add('success');
              } else {
                this.classList.remove('success');
                this.classList.add('error');
              }
            } else {
              this.classList.remove('error', 'success');
            }
          });
        }
      });

      // Name validation
      const nameInput = document.getElementById('signupName');
      if (nameInput) {
        nameInput.addEventListener('blur', function () {
          if (this.value.trim()) {
            if (this.value.trim().length >= 2) {
              this.classList.remove('error');
              this.classList.add('success');
            } else {
              this.classList.remove('success');
              this.classList.add('error');
            }
          } else {
            this.classList.remove('error', 'success');
          }
        });
      }
    }

    // Initialize validation on page load
    document.addEventListener('DOMContentLoaded', setupInputValidation);

    // Show signup form
    function showSignup() {
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("signupBox").classList.remove("hidden");

      // Clear login form
      document.getElementById('loginEmail').value = '';
      document.getElementById('loginPassword').value = '';
      document.getElementById('loginEmail').classList.remove('error', 'success');
      document.getElementById('loginPassword').classList.remove('error', 'success');
      document.getElementById('loginError').classList.remove('show');
    }

    // Show login form
    function showLogin() {
      document.getElementById("signupBox").classList.add("hidden");
      document.getElementById("loginBox").classList.remove("hidden");

      // Clear signup form
      document.getElementById('signupName').value = '';
      document.getElementById('signupEmail').value = '';
      document.getElementById('signupPassword').value = '';
      document.getElementById('signupName').classList.remove('error', 'success');
      document.getElementById('signupEmail').classList.remove('error', 'success');
      document.getElementById('signupPassword').classList.remove('error', 'success');
      document.getElementById('signupError').classList.remove('show');
    }

    // SIGNUP
    async function signup() {
      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const btn = document.getElementById('signupBtn');

      // Validation
      if (!name) {
        showError('signupError', '⚠️ Please enter your name');
        return;
      }

      if (!email || !isValidEmail(email)) {
        showError('signupError', '⚠️ Please enter a valid email address');
        return;
      }

      if (!password || password.length < 6) {
        showError('signupError', '⚠️ Password must be at least 6 characters');
        return;
      }

      // Show loading state
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span>Creating account...';

      try {
        const response = await fetch(`${API_URL}/signup`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email, password })
        });

        const data = await response.json();

        if (response.ok) {
          showSuccess('✅ Account created successfully! Please sign in.');
          showLogin();
        } else {
          showError('signupError', `❌ ${data.message || 'Signup failed'}`);
        }
      } catch (error) {
        showError('signupError', '❌ Network error. Please try again.');
        console.error('Signup error:', error);
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'Create Account';
      }
    }

    // LOGIN
    async function login() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const btn = document.getElementById('loginBtn');

      // Validation
      if (!email || !isValidEmail(email)) {
        showError('loginError', '⚠️ Please enter a valid email address');
        return;
      }

      if (!password) {
        showError('loginError', '⚠️ Please enter your password');
        return;
      }

      // Show loading state
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span>Signing in...';

      try {
        const response = await fetch(`${API_URL}/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (!data.token) {
          showError('loginError', `❌ ${data.message || 'Invalid credentials'}`);
          btn.disabled = false;
          btn.innerHTML = 'Sign In';
          return;
        }

        // Store user data
        localStorage.setItem("token", data.token);
        localStorage.setItem("role", data.role);
        localStorage.setItem("name", data.name);

        // Show success and redirect
        showSuccess(`✅ Welcome back, ${data.name}!`);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        setTimeout(() => {
          if (redirectUrl) {
            window.location.href = redirectUrl;
          } else if (data.role === "admin") {
            window.location.href = "admin/dashboard.html";
          } else {
            window.location.href = "user/dashboard.html";
          }
        }, 1000);

      } catch (error) {
        showError('loginError', '❌ Network error. Please try again.');
        console.error('Login error:', error);
        btn.disabled = false;
        btn.innerHTML = 'Sign In';
      }
    }

    // Handle Enter key
    document.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        const loginBox = document.getElementById('loginBox');
        const signupBox = document.getElementById('signupBox');

        if (!loginBox.classList.contains('hidden')) {
          login();
        } else if (!signupBox.classList.contains('hidden')) {
          signup();
        }
      }
    });
  </script>
</body>

</html>